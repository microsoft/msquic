#
# This pipeline builds and publishes the MsQuic docker image.
#

trigger: none
pr: none

name: 0.$(Date:yyyy).$(Date:MM).$(DayOfMonth).$(Rev:rr).0

parameters:
- name: client
  type: string
  displayName: Client
  default: quant
- name: server
  type: string
  displayName: Server
  default: msquic

steps: client_${{ parameters.client }}_vs_server_${{ parameters.server }}
- script: |
    apk add libxml2-dev libxslt-dev
    sudo apt-get install -y python-setuptools
    pip3 install -r pyshark
    git clone "https://github.com/marten-seemann/quic-interop-runner.git"
    cd quic-interop-runner
    pip3 install -r requirements.txt
    python3 pull.py
    python3 run.py -s ${{ parameters.server }} -c ${{ parameters.client }}
