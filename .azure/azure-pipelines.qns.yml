#
# This pipeline executes a single run of the interop runner between a chosen
# client and server implementation.
#
# TODO:
#  - Only pull running implementations.
#  - Specify an explicit log directory.
#  - Upload that log directory.
#  - Support running whole matrix in parallel.
#

trigger: none
pr: none

name: 0.$(Date:yyyy).$(Date:MM).$(DayOfMonth).$(Rev:rr).0

parameters:
- name: client
  type: string
  displayName: Client
  default: quant
- name: server
  type: string
  displayName: Server
  default: msquic

stages:
- stage:
  displayName: ${{ parameters.client }} -> ${{ parameters.server }}
  jobs:
  - job:
  steps:
  - script: |
      sudo apt-get install -y python3-setuptools
      git clone "https://github.com/marten-seemann/quic-interop-runner.git"
      cd quic-interop-runner
      pip3 install -r requirements.txt
      python3 pull.py
      python3 run.py -s ${{ parameters.server }} -c ${{ parameters.client }}
