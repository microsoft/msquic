jobs:
- job: make_pgo_pr
  displayName: Make PGO Pull Request
  pool:
    vmImage: ubuntu-latest
  variables:
  - name: runCodesignValidationInjection
    value: false
  - name: skipComponentGovernanceDetection
    value: true
  - group: DeploymentKeys
  steps:
  - checkout: none

  - task: PowerShell@2
    displayName: Prepare Test Machine
    inputs:
      targetType: inline
      pwsh: true
      script: |
        git clone --single-branch --branch main https://github.com/microsoft/msquic

  - task: DownloadBuildArtifacts@0
    displayName: Download Perf Artifacts
    inputs:
      artifactName: performance
      downloadPath: msquic/artifacts/PerfDataResults

  - task: PowerShell@2
    displayName: Create Branch, Commit, and Pull Request
    inputs:
      pwsh: true
      filePath: scripts/make-pgo-pr.ps1
    env:
      MAPPED_DEPLOYMENT_KEY: $(GitHubDeploymentKey)
