# Creates the Windows OS build package.

jobs:
- job: Package
  displayName: Package for Windows OS
  pool:
    vmImage: windows-latest
  steps:
  - task: DownloadBuildArtifacts@0
    displayName: Download Build Artifacts
    inputs:
      artifactName: drop
      itemPattern: drop/win*/*_schannel/**
      downloadPath: $(Build.TempDirectory)

  - task: CopyFiles@2
    displayName: Move Build Artifacts
    inputs:
      sourceFolder: $(Build.TempDirectory)/drop
      targetFolder: artifacts

  - task: PowerShell@2
    displayName: Prepare Package Files
    inputs:
      pwsh: true
      filePath: .azure/scripts/prepare-package.ps1

  - task: CopyFiles@2
    displayName: Move Package Files
    inputs:
      sourceFolder: artifacts/package
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: PublishBuildArtifacts@1
    displayName: Upload Package files
    inputs:
      artifactName: package
      pathToPublish: $(Build.ArtifactStagingDirectory)
      parallel: true
