# Uploads the build artifacts for a single build configuration.

parameters:
  arch: ''
  config: 'Debug,Release'
  publishSymbols: false

steps:
- task: CopyFiles@2
  displayName: Move Build Artifacts
  inputs:
    sourceFolder: artifacts/bin
    contents: '**/!(*.ilk|*.cer|*.exp|*.lastcodeanalysissucceeded)'
    targetFolder: $(Build.ArtifactStagingDirectory)/bin

- task: DeleteFiles@1
  displayName: Clear Artifacts
  condition: succeededOrFailed()
  inputs:
    contents: '**/artifacts/bin/*'

- task: PublishBuildArtifacts@1
  displayName: Upload Build Artifacts
  inputs:
    artifactName: artifacts
    pathToPublish: $(Build.ArtifactStagingDirectory)
    parallel: true

- ${{ if eq(parameters.publishSymbols, true) }}:
  - task: PublishSymbols@2
    inputs:
      symbolsFolder: $(Build.ArtifactStagingDirectory)/bin
      searchPattern: '**/*.pdb'
      symbolServerType: teamServices
      indexSources: false

- task: DeleteFiles@1
  displayName: Clear Staging
  inputs:
    contents: $(Build.ArtifactStagingDirectory)/*
