jobs:
- job: test_distribution
  displayName: Test Distribution
  variables:
  - name: runCodesignValidationInjection
    value: false
  - name: skipComponentGovernanceDetection
    value: true
  pool:
    vmImage: ubuntu-latest

  steps:
  - checkout: self
  - task: DownloadBuildArtifacts@0
    displayName: Download Test
    inputs:
      artifactName: artifacts
      itemPattern: artifacts/bin/linux/x64_Release_openssl/msquictest
      downloadPath: $(Build.SourcesDirectory)
  - task: DownloadBuildArtifacts@0
    displayName: Download Package
    inputs:
      artifactName: distribution
      itemPattern: distribution/*.deb
      downloadPath: $(Build.SourcesDirectory)
  - pwsh: sudo dpkg -i $(Build.SourcesDirectory)/libmsquic_2.1.0_amd64.deb
  - pwsh: $(Build.SourcesDirectory)/msquictest --gtest_filter=ParameterValidation.ValidateApi
