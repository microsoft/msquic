name: Build and DeepTest

on:
  pull_request:
    types: [opened, synchronize]
    branches:
      - master

jobs:
  # First job: Call PR Build workflow (Windows)
  pr-build:
    name: PR Build
    uses: ./.github/workflows/pr-build.yml
    permissions:
      contents: read
      pull-requests: write

  # Second job: Call DeepTest workflow (Ubuntu) - runs after pr-build
  deeptest:
    name: DeepTest
    needs: pr-build
    uses: ./.github/workflows/deeptest-ubuntu.lock.yml
    permissions:
      contents: write
      pull-requests: write
      issues: write
      discussions: write
    secrets: inherit
